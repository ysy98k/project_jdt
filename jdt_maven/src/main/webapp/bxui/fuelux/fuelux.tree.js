!function(a,b){var c=a.fn.tree,d=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.tree.defaults,c),this.$element.on("click",".tree-item",a.proxy(function(a){this.selectItem(a.currentTarget)},this)),this.$element.on("click",".tree-folder-header",a.proxy(function(a){this.selectFolder(a.currentTarget)},this)),this.render()};d.prototype={constructor:d,render:function(){this.populate(this.$element)},populate:function(b){var c=this,d=b.parent(),e=d.find(".tree-loader:eq(0)");e.show(),this.options.dataSource.data(b.data(),function(f){e.hide(),a.each(f.data,function(e,f){var g;if("folder"===f.type){g=c.$element.find(".tree-folder:eq(0)").clone().show(),g.find(".tree-folder-name").html(f.name),g.find(".tree-loader").html(c.options.loadingHTML);var h=g.find(".tree-folder-header");h.data(f),"icon-class"in f&&h.find("i").addClass(f["icon-class"])}else"item"===f.type&&(g=c.$element.find(".tree-item:eq(0)").clone().show(),g.find(".tree-item-name").html(f.name),g.data(f),"additionalParameters"in f&&"item-selected"in f.additionalParameters&&1==f.additionalParameters["item-selected"]&&(g.addClass("tree-selected"),g.find("i").removeClass(c.options["unselected-icon"]).addClass(c.options["selected-icon"])));var i=f.dataAttributes||[];a.each(i,function(a,b){switch(a){case"class":case"classes":case"className":g.addClass(b);break;default:g.attr(a,b)}}),b.hasClass("tree-folder-header")?d.find(".tree-folder-content:eq(0)").append(g):b.append(g)}),c.$element.trigger("loaded",d)})},selectItem:function(b){if(0!=this.options.selectable){var c=a(b),d=this.$element.find(".tree-selected"),e=[];this.options.multiSelect?a.each(d,function(b,d){var f=a(d);f[0]!==c[0]&&e.push(a(d).data())}):d[0]!==c[0]&&(d.removeClass("tree-selected").find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"]),e.push(c.data()));var f="selected";c.hasClass("tree-selected")?(f="unselected",c.removeClass("tree-selected"),c.find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"])):(c.addClass("tree-selected"),c.find("i").removeClass(this.options["unselected-icon"]).addClass(this.options["selected-icon"]),this.options.multiSelect&&e.push(c.data())),e.length&&this.$element.trigger("selected",{info:e}),c.trigger("updated",{info:e,item:c,eventType:f})}},selectFolder:function(b){var c,d,e,f=a(b),g=f.parent(),h=g.find(".tree-folder-content"),i=h.eq(0),j="."+a.trim(this.options["close-icon"].replace(/\s/g,"."));f.find(j).length?(c="opened",d=this.options["close-icon"],e=this.options["open-icon"],i.show(),h.children().length||this.populate(f)):(j="."+a.trim(this.options["open-icon"].replace(/\s/g,".")),c="closed",d=this.options["open-icon"],e=this.options["close-icon"],i.hide(),this.options.cacheItems||i.empty()),g.find(j).eq(0).removeClass(d).addClass(e),this.$element.trigger(c,f.data())},selectedItems:function(){var b=this.$element.find(".tree-selected"),c=[];return a.each(b,function(b,d){c.push(a(d).data())}),c},collapse:function(){var b=this.options.cacheItems;this.$element.find("."+this.options["open-icon"]).each(function(){var c=a(this).removeClass(this.options["open-icon"]).addClass(this.options["close-icon"]),d=c.parent().parent(),e=d.children(".tree-folder-content");e.hide(),b||e.empty()})}},a.fn.tree=function(c){var e,f=Array.prototype.slice.call(arguments,1),g=this.each(function(){var b=a(this),g=b.data("tree"),h="object"==typeof c&&c;g||b.data("tree",g=new d(this,h)),"string"==typeof c&&(e=g[c].apply(g,f))});return e===b?g:e},a.fn.tree.defaults={multiSelect:!1,loadingHTML:"<div>Loading...</div>",cacheItems:!0},a.fn.tree.Constructor=d,a.fn.tree.noConflict=function(){return a.fn.tree=c,this}}(window.jQuery);